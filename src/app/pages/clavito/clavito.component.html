<div class="clavito-container" *ngIf="game">
  <!-- Header -->
  <div class="clavito-header">
    <button class="back-btn" (click)="goBack()">â† Volver</button>
    <h2>ğŸ´ Clavito</h2>
  </div>

  <!-- Collapsible Game Instructions -->
  <div class="game-info-collapsible">
    <button class="info-toggle" (click)="toggleInstructions()" [class.expanded]="showInstructions">
      <span class="toggle-icon">{{ showInstructions ? 'â–¼' : 'â–¶' }}</span>
      <span>ğŸ“‹ Instrucciones del juego</span>
    </button>

    <div class="game-info" [class.expanded]="showInstructions">
      <div class="info-content">
        <p><strong>ğŸ¯ Objetivo:</strong> Ser el Ãºltimo jugador en pie</p>
        <p><strong>ğŸ‘† CÃ³mo jugar:</strong> Toca el nombre de un jugador para sumarle un punto cuando se equivoque</p>
        <p><strong>ğŸ›¡ï¸ Pellejo:</strong> El primer jugador en llegar a 3 puntos recibe una vida extra</p>
        <p><strong>âŒ EliminaciÃ³n:</strong></p>
        <ul>
          <li>Con pellejo: eliminado a los 4 puntos</li>
          <li>Sin pellejo: eliminado a los 3 puntos</li>
        </ul>
        <p><strong>â• AÃ±adir jugadores:</strong> Los nuevos jugadores entran con los mismos puntos que el lÃ­der (o 2
          puntos si el lÃ­der tiene pellejo)</p>
      </div>
    </div>
  </div>

  <!-- Add Player Section -->
  <div class="add-player-section" *ngIf="game.gamePhase === 'playing'">
    <button class="add-player-btn" (click)="toggleAddPlayer()">
      {{ showAddPlayer ? 'âœ–ï¸ Cancelar' : 'â• AÃ±adir Jugador' }}
    </button>

    <div class="add-player-form" [class.expanded]="showAddPlayer">
      <div class="form-content">
        <h4>AÃ±adir nuevo jugador</h4>
        <p class="entry-info">
          El nuevo jugador entrarÃ¡ con: <strong>{{ getPlayerInitialScore() }}</strong>
        </p>

        <!-- Existing Players -->
        <div class="existing-players" *ngIf="availablePlayers.length > 0">
          <h5>Jugadores disponibles:</h5>
          <div class="available-players-grid">
            <button *ngFor="let player of availablePlayers" class="available-player-btn"
              (click)="addExistingPlayer(player)">
              {{ player.name }}
            </button>
          </div>
        </div>

        <!-- New Player -->
        <div class="new-player-form">
          <h5>O crear nuevo jugador:</h5>
          <div class="input-group">
            <input type="text" [(ngModel)]="newPlayerName" placeholder="Nombre del nuevo jugador"
              class="player-name-input" (keyup.enter)="addNewPlayer()">
            <button class="add-btn" (click)="addNewPlayer()" [disabled]="!newPlayerName.trim()">
              AÃ±adir
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Score Summary -->
  <div class="score-summary" *ngIf="game.gamePhase === 'playing'">
    <h3>ğŸ“Š Resumen de PuntuaciÃ³n</h3>
    <div class="summary-grid">
      <div *ngFor="let player of game.players; trackBy: trackByPlayerId" class="summary-item"
        [class.eliminated]="player.isEliminated" [class.pellejo]="player.hasPellejo"
        [class.danger]="player.currentScore >= (player.hasPellejo ? 3 : 2)">

        <div class="player-name">{{ player.name }}</div>

        <div class="roman-score" [class.pulsing]="shouldPulse(player)">
          <span class="roman-numerals" [attr.data-score]="player.currentScore">
            {{ getRomanNumeral(player.currentScore) }}
          </span>
          <div class="score-indicator" [attr.data-level]="getScoreLevel(player)"></div>
        </div>

        <div class="player-status">
          <span *ngIf="player.hasPellejo" class="status-badge pellejo-badge">ğŸ›¡ï¸</span>
          <span *ngIf="player.isEliminated" class="status-badge eliminated-badge">ğŸ’€</span>
          <span *ngIf="!player.isEliminated && !player.hasPellejo" class="status-badge active-badge">âœ“</span>
        </div>

        <!-- Remove Player Button -->
        <button *ngIf="game.players.length > 2" class="remove-player-btn" (click)="removePlayer(player.id)"
          title="Eliminar jugador del juego">
          ğŸ—‘ï¸
        </button>
      </div>
    </div>
  </div>

  <!-- Active Players (Juego) -->
  <div class="players-section" *ngIf="getActivePlayers().length > 0">
    <h3>ğŸ¯ Jugadores Activos ({{ getActivePlayers().length }})</h3>

    <div class="players-grid">
      <div *ngFor="let player of getActivePlayers(); trackBy: trackByPlayerId" class="player-card active-player"
        (click)="addPoint(player.id)">

        <div class="player-header">
          <h4>{{ player.name }}</h4>
          <span *ngIf="player.hasPellejo" class="pellejo-badge">ğŸ›¡ï¸ Pellejo</span>
        </div>

        <div class="score-display">
          <div class="score-circles">
            <div class="score-circle" *ngFor="let point of getScoreArray(player); let i = index"
              [class.filled]="player.currentScore > i">
              {{ i + 1 }}
            </div>
          </div>
          <p class="score-text">
            {{ player.currentScore }} / {{ player.hasPellejo ? 4 : 3 }} puntos
            <span *ngIf="player.hasPellejo" class="pellejo-text">(con pellejo)</span>
          </p>
        </div>

        <div class="player-actions" (click)="$event.stopPropagation()">
          <button class="remove-point-btn" (click)="removePoint(player.id)" [disabled]="player.currentScore === 0"
            title="Quitar punto">
            -1
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Eliminated Players -->
  <div class="players-section" *ngIf="getEliminatedPlayers().length > 0">
    <h3>âŒ Jugadores Eliminados ({{ getEliminatedPlayers().length }})</h3>

    <div class="eliminated-list">
      <div *ngFor="let player of getEliminatedPlayers(); trackBy: trackByPlayerId"
        class="player-card eliminated-player">

        <div class="player-header">
          <h4>{{ player.name }}</h4>
          <span class="eliminated-badge">
            Eliminado ({{ player.currentScore }} pts)
          </span>
        </div>

        <div class="score-display">
          <p class="score-text">
            {{ player.currentScore }} puntos -
            {{ player.hasPellejo ? 'TenÃ­a pellejo' : 'Sin pellejo' }}
          </p>
        </div>

        <div class="player-actions">
          <button class="remove-point-btn" (click)="removePoint(player.id)" [disabled]="player.currentScore === 0"
            title="Quitar punto (puede reactivar al jugador)">
            -1
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Game Finished -->
  <div class="winner-section" *ngIf="game.gamePhase === 'finished'">
    <div class="winner-card">
      <h3>ğŸ† Â¡Juego Terminado!</h3>
      <div class="winner-info">
        <h2>{{ game.winner?.name }} ha ganado</h2>
        <p>Â¡Felicidades por ser el Ãºltimo en pie!</p>
      </div>
      <div class="winner-actions">
        <button class="restart-btn" (click)="resetGame()">ğŸ”„ Jugar de nuevo</button>
        <button class="back-btn-alt" (click)="goBack()">ğŸ  Volver al inicio</button>
      </div>
    </div>
  </div>

  <!-- Game Controls -->
  <div class="game-controls" *ngIf="game.gamePhase === 'playing'">
    <button class="reset-btn" (click)="resetGame()">ğŸ”„ Reiniciar Juego</button>
  </div>
</div>
